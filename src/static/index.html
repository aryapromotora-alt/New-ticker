<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor Google News para RSS Ticker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container {
            max-width: 1200px; margin: 0 auto; background: white;
            border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 300; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .form-section { padding: 40px; background: #f8f9fa; }
        .input-group { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .url-input {
            flex: 1; min-width: 300px; padding: 15px 20px;
            border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px;
            transition: all 0.3s ease;
        }
        .url-input:focus {
            outline: none; border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66,133,244,0.1);
        }
        .convert-btn {
            padding: 15px 30px; background: linear-gradient(135deg,#4285f4 0%,#34a853 100%);
            color: white; border: none; border-radius: 10px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease; min-width: 150px;
        }
        .convert-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(66,133,244,0.3); }
        .convert-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: none; text-align: center; padding: 20px; color: #666; }
        .spinner {
            border: 3px solid #f3f3f3; border-top: 3px solid #4285f4;
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 0 auto 10px;
        }
        @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
        .ticker-container {
            background: #1a1a1a; color: white; margin: 20px 0;
            border-radius: 10px; overflow: hidden; display: none;
        }
        .ticker-header {
            background: #d32f2f; color: white; padding: 10px 20px;
            font-weight: bold; font-size: 16px; display: flex; align-items: center; gap: 10px;
        }
        .ticker-header::before { content: "ðŸ”´"; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
        .ticker-content {
            height: 40px; overflow: hidden; position: relative;
            background: #111; border-top: 2px solid #d32f2f;
        }
        .ticker-scroll {
            position: absolute; white-space: nowrap;
            animation: scroll 40s linear infinite;
            line-height: 40px; font-size: 16px; color: #fff; padding: 0 20px;
        }
        @keyframes scroll { 0%{transform:translateX(100%);} 100%{transform:translateX(-100%);} }
        .news-item { display: inline-block; margin-right: 80px; color: #fff; }
        .news-source { color: #4285f4; font-weight: bold; margin-right: 10px; }
        .error, .success {
            padding: 15px; border-radius: 10px; margin: 20px 0; display: none;
        }
        .error { background:#ffebee; color:#c62828; border-left:4px solid #c62828; }
        .success { background:#e8f5e8; color:#2e7d32; border-left:4px solid #2e7d32; }
        .rss-output {
            background:#f5f5f5; border:1px solid #ddd; border-radius:10px;
            padding:20px; margin:20px 0; display:none;
        }
        .rss-output h3 { margin-bottom: 15px; color: #333; }
        .rss-content {
            background: white; padding: 15px; border-radius: 5px;
            font-family: 'Segoe UI', sans-serif; font-size: 14px;
            max-height: 300px; overflow-y: auto;
        }
        .copy-btn {
            background:#4285f4; color:white; border:none;
            padding:10px 20px; border-radius:5px; cursor:pointer;
            margin-top:10px; transition:background 0.3s ease;
        }
        .copy-btn:hover { background:#3367d6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“° Conversor Google News</h1>
            <p>Transforme links do Google News em RSS Feed Ticker</p>
        </div>

        <div class="form-section">
            <div class="input-group">
                <input type="url" class="url-input" id="newsUrl" placeholder="Cole aqui o link do Google News..." required>
                <button class="convert-btn" id="convertBtn" onclick="convertNews()">Converter</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processando notÃ­cias...</p>
            </div>

            <div class="error" id="error"></div>
            <div class="success" id="success"></div>

            <div class="ticker-container" id="tickerContainer">
                <div class="ticker-header">Suas notÃ­cias</div>
                <div class="ticker-content"><div class="ticker-scroll" id="tickerScroll"></div></div>
            </div>

            <div class="rss-output" id="rssOutput">
                <h3>ðŸ“„ Feed RSS Gerado (prÃ©via):</h3>
                <div class="rss-content" id="rssContent"></div>
                <button class="copy-btn" onclick="copyRSS()">Copiar RSS Completo</button>
            </div>
        </div>
    </div>

    <script>
        let currentRSSContent = '';

        async function convertNews() {
            const urlInput = document.getElementById('newsUrl');
            const convertBtn = document.getElementById('convertBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const success = document.getElementById('success');
            const tickerContainer = document.getElementById('tickerContainer');
            const rssOutput = document.getElementById('rssOutput');

            const url = urlInput.value.trim();
            if (!url) {
                showError('Por favor, insira um URL vÃ¡lido do Google News.');
                return;
            }

            hideMessages();
            convertBtn.disabled = true;
            loading.style.display = 'block';
            tickerContainer.style.display = 'none';
            rssOutput.style.display = 'none';

            try {
                const response = await fetch(`/api/ticker/convert?url=${encodeURIComponent(url)}`);
                const rssContent = await response.text();

                if (rssContent.includes("<item>")) {
                    showSuccess("âœ… RSS gerado com sucesso!");
                    displayRSS(rssContent);
                    displayTicker(rssContent);
                } else {
                    showError("NÃ£o foi possÃ­vel gerar RSS vÃ¡lido.");
                }
            } catch (err) {
                showError("Erro de conexÃ£o. Tente novamente.");
                console.error("Erro:", err);
            } finally {
                convertBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function displayTicker(rssContent) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(rssContent, "application/xml");
            const items = xmlDoc.getElementsByTagName("item");

            let tickerHTML = '';
            for (let i = 0; i < Math.min(items.length, 10); i++) {
                const title = items[i].getElementsByTagName("title")[0]?.textContent || "Sem tÃ­tulo";
                const link = items[i].getElementsByTagName("link")[0]?.textContent || "#";

                tickerHTML += `
                    <span class="news-item">
                        <a href="${link}" target="_blank" style="color:white; text-decoration:none;">
                            ${title}
                        </a>
                    </span>
                `;
            }

            const tickerScroll = document.getElementById('tickerScroll');
            tickerScroll.innerHTML = tickerHTML;
            document.getElementById('tickerContainer').style.display = 'block';
            tickerScroll.style.animation = 'none';
            tickerScroll.offsetHeight;
            tickerScroll.style.animation = 'scroll 40s linear infinite';
        }

        function displayRSS(rssContent) {
            const rssOutput = document.getElementById('rssOutput');
            const rssContentDiv = document.getElementById('rssContent');

            let preview = '';
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(rssContent, "application/xml");
                const items = xmlDoc.getElementsByTagName("item");

                preview += "<ul style='list-style:none; padding-left:0'>";
                for (let i = 0; i < Math.min(items.length, 5); i++) {
                    const title = items[i].getElementsByTagName("title")[0].textContent;
                    const link = items[i].getElementsByTagName("link")[0].textContent;
                    preview += `<li style="margin: 5px 0;">
                                  <a href="${link}" target="_blank" style="color:#4285f4; text-decoration:none;">
                                    ${title}
                                  </a>
                                </li>`;
                }
                preview += "</ul>";
            } catch (e) {
                preview = "<p style='color:red'>Erro ao prÃ©-visualizar RSS</p>";
            }

            currentRSSContent = rssContent;
            rssContentDiv.innerHTML = preview;
            rssOutput.style.display = 'block';
        }

        function copyRSS() {
            navigator.clipboard.writeText(currentRSSContent).then(() => {
                showSuccess("RSS copiado para a Ã¡rea de transferÃªncia!");
            }).catch(() => {
                showError("Erro ao copiar RSS.");
            });
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.style.display = 'block';
        }
        function showSuccess(message) {
            const success = document.getElementById('success');
            success.textContent = message;
            success.style.display = 'block';
        }
        function hideMessages() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }
        document.getElementById('newsUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') convertNews();
        });
    </script>
</body>
</html>
